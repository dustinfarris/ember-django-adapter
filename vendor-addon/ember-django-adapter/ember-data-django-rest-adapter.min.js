// ==========================================================================
// Project:   Ember Data Django Rest Adapter
// Copyright: (c) 2013 Toran Billups http://toranbillups.com
// License:   MIT
// ==========================================================================


// v1.0.3
// cbd7510 (2014-05-14 16:35:54 -0400)


!function(){DS.DjangoRESTSerializer=DS.RESTSerializer.extend({init:function(){this._super.apply(this,arguments)},extractDjangoPayload:function(a,b,c){b.eachRelationship(function(b,d){if(Ember.isNone(c[b])||"number"==typeof c[b][0]||"string"==typeof c[b][0]||"hasMany"!==d.kind){if(!Ember.isNone(c[b])&&"object"==typeof c[b]&&"belongsTo"===d.kind){var e=c[b].id;this.pushSinglePayload(a,d.type,c[b]),c[b]=e}}else if("array"===Ember.typeOf(c[b])&&c[b].length>0){var f=c[b].mapBy("id");this.pushArrayPayload(a,d.type,c[b]),c[b]=f}},this)},extractSingle:function(a,b,c){return this.normalize(b,c),this.extractDjangoPayload(a,b,c),c},extractArray:function(a,b,c){for(var d=this,e=0;e<c.length;e++)this.normalize(b,c[e]),d.extractDjangoPayload(a,b,c[e]);return c},pushSinglePayload:function(a,b,c){b=a.modelFor(b),c=this.extract(a,b,c,null,"find"),a.push(b,c)},pushArrayPayload:function(a,b,c){b=a.modelFor(b),c=this.extract(a,b,c,null,"findAll"),a.pushMany(b,c)},keyForAttribute:function(a){return Ember.String.decamelize(a)},keyForRelationship:function(a){return Ember.String.decamelize(a)},serializeBelongsTo:function(a,b,c){var d=c.key,e=a.get(d),f=this.keyForRelationship?this.keyForRelationship(d,"belongsTo"):d;b[f]=Ember.isNone(e)?e:"string"==typeof a.get(d)?a.get(d):a.get(d).get("id"),c.options.polymorphic&&this.serializePolymorphicType(a,b,c)},serializeHasMany:function(a,b,c){var d=c.key,e=this.keyForRelationship(d,"hasMany"),f=DS.RelationshipChange.determineRelationshipType(a.constructor,c);("manyToNone"===f||"manyToMany"===f)&&(b[e]=a.get(d).mapBy("id"))}})}(),function(){var a=Ember.get;DS.DjangoRESTAdapter=DS.RESTAdapter.extend({defaultSerializer:"DS/djangoREST",pathForType:function(a){var b=Ember.String.decamelize(a);return Ember.String.pluralize(b)},createRecord:function(a,b,c){var d=this.buildURL(b.typeKey),e=a.serializerFor(b.typeKey).serialize(c);return this.ajax(d,"POST",{data:e})},updateRecord:function(b,c,d){var e=b.serializerFor(c.typeKey).serialize(d),f=a(d,"id");return this.ajax(this.buildURL(c.typeKey,f),"PUT",{data:e})},findMany:function(a,b,c,d){var e,f,g;return d&&(g=this.getHasManyAttributeName(b,d,c),f=a.serializerFor(b.typeKey).keyForAttribute(g),e=this.buildFindManyUrlWithParent(b,d,f)),this.ajax(e,"GET")},ajax:function(a,b,c){return c=c||{},c.cache=!1,this._super(a,b,c)},buildURL:function(a,b){var c=this._super(a,b);return"/"!==c.charAt(c.length-1)&&(c+="/"),c},buildFindManyUrlWithParent:function(a,b,c){var d,e,f;return f=b.get("id"),d=b.constructor.typeKey,e=this.buildURL(d,f),e+c+"/"},getHasManyAttributeName:function(a,b,c){var d;return b.eachRelationship(function(e,f){var g;"hasMany"===f.kind&&f.type.typeKey===a.typeKey&&(g=b._data[e].mapBy("id"),Ember.EnumerableUtils.intersection(c,g).length===c.length&&(d=e))}),d}})}(),function(){var a="1.0.3";DS.DjangoRESTSerializer.VERSION=a,DS.DjangoRESTAdapter.VERSION=a,Ember.libraries&&Ember.libraries.register("ember-data-django-rest-adapter",a)}();